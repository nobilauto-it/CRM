# Маппинг: наша БД → 999.md (Легковые автомобили, Продам)

**Категория:** 658 (Транспорт)  
**Подкатегория:** 659 (Легковые автомобили)  
**Тип предложения:** 776 (Продам)

Данные получены по API с токеном (auth успешна: `GET /cash` → 200).

---

## Обязательные поля 999.md (required: true)

| 999.md feature id | Название на 999 | Тип | Наше поле в БД / источник |
|-------------------|------------------|-----|---------------------------|
| **20** | Марка | drop_down_options | `marca` / `brand_val` / DEALS_F_BRAND — **нужен id опции** (см. список марок в `999md_features_cars_sell.json` или API `/features`). Маппинг по названию марки → option.id |
| **21** | Модель | drop_down_options | `model` / `model_val` / DEALS_F_MODEL — **зависит от Марки** (depends_on: 20). Опции через `GET /dependent_options?subcategory_id=659&dependency_feature_id=20&parent_option_id=<id_марки>` |
| **2095** | Поколение | drop_down_options | зависит от Модели (21). Нет в нашей БД — выбрать дефолт или запросить dependent_options |
| **775** | Регистрация | drop_down_options | 5 опций. Нет в БД — задать дефолт (напр. «Молдова») |
| **593** | Состояние | drop_down_options | 3 опции. Нет в БД — дефолт |
| **1761** | Наличие | drop_down_options | 3 опции. Дефолт |
| **1763** | Происхождение автомобиля | drop_down_options | 6 опций. Дефолт |
| **795** | Автор объявления | drop_down_options | 2 опции (Агентство/Частное лицо). Дефолт |
| **19** | Год выпуска | textbox_numeric | `year` / поле года из БД (если есть) |
| **1196** | Руль | drop_down_options | Левый/Правый. Дефолт по региону |
| **846** | Количество мест | drop_down_options | если есть в БД — маппинг, иначе дефолт |
| **102** | Тип кузова | drop_down_options | если есть в БД (седан, универсал и т.д.) — маппинг по названию |
| **104** | Пробег | textbox_numeric_measurement | пробег из БД (value + unit: `km` или `mi`) |
| **2553** | Двигатель | drop_down_options | если есть в БД — маппинг; иначе дефолт |
| **151** | Тип топлива | drop_down_options | бензин/дизель/электро и т.д. — по БД или дефолт |
| **108** | Привод | drop_down_options | передний/задний/полный |
| **7** | Регион | drop_down_options | регион/филиал из БД — подобрать option id по названию (44 опции) |
| **2** | Цена | textbox_numeric_measurement | `total_suma` / `pret` / цена из сделки. value + unit: `eur` / `usd` / `mdl` |
| **14** | Фото | upload_images | **обязательно.** Сначала `POST /images` для каждого файла, затем массив `image_id` в value |

---

## Необязательные, но полезные для маппинга

| 999.md feature id | Название на 999 | Тип | Наше поле в БД |
|-------------------|------------------|-----|----------------|
| **13** | body (описание) | textarea_text | описание из сделки; можно добавить номер авто (`numar_auto`), комментарий |
| **2512** | VIN-код | textbox_text | VIN из БД (если есть) |
| **1640** | Старая цена | textbox_numeric | если есть |
| **16** | Контакты | contacts | массив телефонов в междунар. формате (напр. `["37378123456"]`) — из настроек или из сделки/контакта |
| **101** | КПП | drop_down_options | если есть в БД |
| **107** | Мощность (л.с.) | textbox_numeric_measurement | value + unit: `hp` |
| **17** | Цвет | drop_down_options | цвет из БД |
| **851** | Количество дверей | drop_down_options | если есть |
| **12** | title (заголовок) | — | в доке 999 для объявления заголовок часто в фиче id **12**; в текущем ответе `/features` поля «title» нет, но в примере Add advert есть `"id":"12", "value":"test title"`. Проверить по API: если есть фича с id 12 — маппить `title` сделки или «Марка Модель Год» |

---

## Итоговая схема при создании объявления (POST /adverts)

```json
{
  "category_id": "658",
  "subcategory_id": "659",
  "offer_type": "776",
  "features": [
    { "id": "20", "value": "<option_id_марки>" },
    { "id": "21", "value": "<option_id_модели>" },
    { "id": "2095", "value": "<option_id_поколения>" },
    { "id": "775", "value": "<option_id_регистрации>" },
    { "id": "593", "value": "<option_id_состояния>" },
    { "id": "1761", "value": "<option_id_наличия>" },
    { "id": "1763", "value": "<option_id_происхождения>" },
    { "id": "795", "value": "<option_id_автора>" },
    { "id": "19", "value": 2020 },
    { "id": "1196", "value": "<option_id_руль>" },
    { "id": "846", "value": "<option_id_мест>" },
    { "id": "102", "value": "<option_id_тип_кузова>" },
    { "id": "104", "value": 50000, "unit": "km" },
    { "id": "2553", "value": "<option_id_двигатель>" },
    { "id": "151", "value": "<option_id_топливо>" },
    { "id": "108", "value": "<option_id_привод>" },
    { "id": "7", "value": "<option_id_регион>" },
    { "id": "2", "value": 15000, "unit": "eur" },
    { "id": "13", "value": "Описание. Numar auto: ABC 123." },
    { "id": "14", "value": ["<image_id_1>", "<image_id_2>"] },
    { "id": "16", "value": ["37378123456"] }
  ]
}
```

---

## Откуда брать option id для Марки и Модели

- **Марка (20):** в `999md_features_cars_sell.json` в группе «Общее» у фичи «Марка» есть массив `options`: каждый элемент `{ "id": "34", "title": "BMW" }`. Ищем по `title` (нормализованному), подставляем `id`.
- **Модель (21):** опции не в `/features` (options_count: 0, depends_on: "20"). Нужен запрос `GET /dependent_options?subcategory_id=659&dependency_feature_id=20&parent_option_id=<id_выбранной_марки>&lang=ru` — вернёт список моделей для этой марки. По названию модели из БД выбираем option id.

Токен для API хранить в переменной окружения `API_999MD_TOKEN`, не коммитить в репозиторий.
