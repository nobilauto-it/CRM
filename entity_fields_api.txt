API для получения полей выбранной сущности (смарт-процесс или сделка).

Этот модуль предоставляет эндпоинт для получения списка полей конкретной сущности.
Используется фронтендом после выбора сущности для отображения доступных полей.

Основные функции:
- get_entity_fields() - возвращает список полей для выбранной сущности

Параметры запроса:
- type (обязательный): тип сущности - "smart_process" или "deal"
- entity_key (опциональный): ключ сущности (обязателен для smart_process, для deal не нужен)
  - Для смарт-процессов: формат "sp:1114" (где 1114 - entity_type_id)
  - Для сделок: не требуется, используется "deal"

Структура ответа:
{
    "ok": true,
    "entity_key": "sp:1114",
    "type": "smart_process",
    "fields_count": 25,
    "fields": [
        {
            "b24_field": "UF_CRM_1234567890",
            "column_name": "uf_crm_1234567890",
            "b24_type": "string",
            "is_multiple": false,
            "is_required": false,
            "is_readonly": false,
            "title": "Название поля",
            "labels": {
                "title": "Название поля",
                "formLabel": "Название поля",
                "listLabel": "Название поля"
            },
            "settings": {...}
        }
    ]
}

Примеры использования:
1. Получить поля для сделок:
   GET /api/entity-fields/?type=deal

2. Получить поля для смарт-процесса:
   GET /api/entity-fields/?type=smart_process&entity_key=sp:1114

ИСТОРИЯ ИЗМЕНЕНИЙ:
==================

2026-01-09 - Создание модуля
    - Создан файл entity_fields_api.py
    - Реализован эндпоинт GET /api/entity-fields/ для получения полей сущности
    - Принимает параметры: type (smart_process или deal) и entity_key (для смарт-процессов)
    - Возвращает список полей из таблицы b24_meta_fields
    - Добавлена валидация параметров (проверка type, обязательность entity_key для smart_process)
    - Для сделок используется entity_key="deal", для смарт-процессов - переданный entity_key
    - Поля возвращаются с полной информацией: b24_field, column_name, b24_type, флаги, title, labels, settings
    - Роутер подключен в app.py
    - Документация вынесена в entity_fields_api.txt, код очищен от docstring

2026-01-09 - Гарантированный возврат title для всех полей
    - Изменена логика: теперь title всегда возвращается для каждого поля (если нет b24_title, используется column_name как fallback)
    - Добавлено поле "name" как дубликат title для удобства фронтенда
    - Это гарантирует, что фронтенд всегда получит человеко-читаемое название поля

2026-01-09 - Улучшение получения title для UF полей
    - Расширена логика получения title: b24_title -> labels (title, label, listLabel, formLabel, filterLabel) -> понятное имя
    - Если labels хранится как JSON строка, автоматически парсится
    - Для UF полей (ufCrm34_*) улучшена обработка: если нет title в мета-таблице, создается более читаемое имя из column_name
    - Это гарантирует, что даже для UF полей без явного title будет возвращено понятное название

2026-01-09 - Удаление технических имен из ответа fields
    - Изменена структура ответа: теперь возвращаются только человеко-читаемые данные
    - Убраны технические имена (b24_field, column_name) из ответа fields
    - В ответе fields теперь только: title, name (дубликат title), type, is_multiple, is_required, is_readonly
    - Фронтенд больше не видит технические имена типа "uf_crm_1739464880408" или "date_modify"
    - Все технические имена скрыты, фронтенд работает только с понятными названиями (title)
    - Labels и settings остаются как опциональная информация, если нужны
